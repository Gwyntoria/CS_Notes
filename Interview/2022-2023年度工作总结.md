# 2022-2023 年度工作总结

本人在过去的一年（2022/9-2023/10）中，在公司从事嵌入式软件开发，工作的主要内容分为两大块，一是基于海思芯片(Hi3516DV300, Hi3520DV200)和 SRS 的视频推流服务，二是基于汇顶芯片(GR5515)的人体健康数据采集服务。

## 1. 项目任务描述及相关结果

### 1.1. 基于 Hi3516DV300 的 IPC

本项目的目的是，结合 IPC 和 SRS 等流媒体服务器，完成高稳定性和低延迟的音视频推拉流服务。在本项目中我主要负责 IPC 端的音视频推流业务，本年度相关工作内容如下：

1. 完成 #2 套件和 #10 套件共 34 套 IPC 的安装。

2. 优化 librtmp。

   - 解决网络断后重连时推流服务无法正常重连的问题。

   - 基于 RTMP 和 FLV 协议，对 librtmp 中关于 H264、H265、AAC、Opus 的 FLV 封装进行实现和优化。

3. 实现低码率模式，降低在无人拉流时的推流端的带宽消耗。

4. 优化 IMX385 的驱动，简化 sensor 与主控之间的通讯过程。

5. 实现 http server，以实现通过 http 请求完成各种模式之间的控制，以及 IPC 设备信息的网页显示。

6. 实现 Opus 音频编码器在 Hi3516DV300 上的移植，并且接入网宿的 RTMP+Opus 的推流服务标准。

7. 通过 NTP 协议完成本地时间与网络时间的同步。（目前的请求对象是公开的阿里云 NTP 服务器）

8. 在 Hi3516DV300 上移植 MetaRTC 库，并且接入网宿科技的 webrtc 推流服务。

9. 配合同事调试基于 Hi3516DV300 并应用于 IPC 推流服务的主控板开发。

### 1.2. 基于 Hi3520DV200 的视频编码器

本项的目的是，使用现阶段已有的 402 音视频编码器，使用自研的推流固件接入已有的流媒体服务架构，并保持高稳定性和低延迟。本年度相关工作内容如下：

1. 配合同事完成对 402 编码器推流程序的基本实现。

2. 完成 fdkaac 音频编码库的接入。

### 1.3. 基于汇顶 GR5515 的智能戒指

本项的目的是，基于汇顶 GR5515 芯片，实现能够采集人体如心率、血氧、HRV 等生理数据的智能穿戴戒指。本年度相关工作内容如下：

1. 配合硬件同事调试基于 GR5515 SDK1.7.0 的可用于调试板的基本固件。

2. 结合现有论文和网络信息完成心率变异性、呼吸频率的检测算法。

3. 对接利尔达的技术支持，完成 gh3x2x 健康传感器的驱动移植。

## 2. 知识与技能提升

在过去的一年中，我在工作中加深了对网络编程中的 socket 通讯，HTTP 事务，并发编程中的共享变量、同步线程等知识的理解与应用。学会了使用 shell 脚本完成的 IPC 端对于进程管理和数据传输的自动化服务。在接触硬件的时候也学习更为底层的硬件通讯协议，如 I2C、SPI。也接触了为普通 MCU 设计的 OpenRTOS，了解更深入地学习了关于线程的底层实现。我也已将部分学习结果总结成 4 篇学习文档。

在软件设计的相关内容上，我也在开发过程中学习了一些事件驱动编程和设计模式的相关知识。

为了更方便理解开源库和协议，我也学习并使用了 UML 来帮助我整理开源库和协议的流程或结构逻辑，以提升我对其的理解和使用效率。

## 3. 挑战和解决方案

在过往的一年中，我接触到的最大的挑战就是对类似 WebRTC、H264 等协议的理解。目前我在学习此类未曾接触到过的协议时，通常会先借助 ChatGPT、Wiki、CSDN 等做一个大致了解，之后再通过相关的 Spec 和 RFC 文档做进一步的深度学习，并且使用 UML 整理逻辑的相关实现。

## 4. 年度学习目标

### 4.1. 目标回顾

在去年 9 月中我制订的年度目标中，关于 Linux 系统，C++、Python 编程深入的学习，现阶段我已大体完成。对于海思 MPP 的整体框架，我也基本掌握。

但关于 Linux 驱动等相关知识，我还并未深入学习。

### 4.2. 新年度学习目标

1. 学习 Linux 驱动编程。

2. 深入学习关于设计模式、事件驱动等软件设计知识。

3. 深入理解并发编程。
